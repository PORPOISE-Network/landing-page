<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords"
        content="PORPOISE, Proof of Reputation, Protocol, zero knowledge proof, zkSNARK, crypto, Mina Protocol, Protokit, surveys, predictions">
    <meta name="description" content="Proof of Reputation Protocol">
    <title>PORPOISE Network</title>

    <style>
        body {
            background-color: #000;
            color: #0ff;
            /* Light blue font color */
            font-family: 'Courier New', monospace;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        header {
            padding: 50px;
        }

        h1 {
            font-size: 3em;
            margin: 10px;
        }

        p {
            font-size: 1.2em;
            margin: 20px;
        }

        /* visited link */
        a[href]:visited {
            color: #00d0ff;
        }

        /* mouse over link */
        a[href]:hover {
            color: #00ddff;
        }

        /* unvisited link */
        a[href] {
            color: #0ff;
            text-decoration: none;
        }

        footer {
            padding: 20px;
        }

        header img {
            width: 2.5em;
            /* Set the width to match the font size */
            height: 1em;
            /* Set the height to match the font size */
        }
    </style>

    <script>
        function getSurveyComponents() {

            // Get the search parameters from the URL
            const urlParams = new URLSearchParams(window.location.search);

            const numParams = urlParams.size;
            console.log("URL Params: ", urlParams);

            if (numParams >= 5) {
                const numOptions = numParams - 3;
                console.log("Number of options: ", numOptions);

                // Retrieve the body, deadline, and oracle content
                const dolphin = urlParams.get('üê¨');
                const alarmclock = urlParams.get('‚è∞');
                const oracle = urlParams.get('üîÆ')

                console.log('üê¨ Dolphin:', dolphin);
                console.log('‚è∞ Deadline:', alarmclock);
                console.log('üîÆ Oracle: ', oracle);

                if (dolphin === null) {
                    document.getElementById('üê¨').innerHTML = "Missing üê¨ in URL.";
                    return 0;
                } else {
                    document.getElementById('üê¨').innerHTML = 'üê¨ ' + dolphin.replace(/-/g, ' ');
                }

                if (alarmclock === null) {
                    document.getElementById('üê¨').innerHTML = "Missing ‚è∞ in URL.";
                    return 0;
                } else {
                    document.getElementById('‚è∞').innerHTML = '‚è∞ Deadline: ' + convertUTCtoDate(alarmclock);
                }

                if (oracle === null) {
                    document.getElementById('‚è∞').innerHTML = '';
                    document.getElementById('üê¨').innerHTML = "Missing üîÆ in URL.";
                    return 0;
                } else {
                    document.getElementById('üîÆ').innerHTML = 'üîÆ Oracle Address: ' + oracle;
                }

                // loop over the options and store in an options array
                const options = [];
                for (let i = 1; i <= numOptions; i++) {
                    let option = urlParams.get('üó≥' + i);
                    if (option !== null) {
                        options.push(option.replace(/-/g, ' '));
                    }
                }

                if (options.length < 2) {
                    document.getElementById('‚è∞').innerHTML = '';
                    document.getElementById('üîÆ').innerHTML = '';
                    document.getElementById('üê¨').innerHTML = "A PORPOISE survey must have at least 2 options (üó≥1 & üó≥2)."
                    return 0;
                } else {
                    setOptions(options);
                }
            } else {
                const message = "Not enough emojis for a PORPOISE-compatible survey."
                document.getElementById('üê¨').innerHTML = message;
                console.log(message)
            }
            return 1;
        }

        function setOptions(optionsArray) {
            let optionsContainer = document.getElementById('üó≥')

            for (let i = 0; i < optionsArray.length; i++) {
                console.log("Option", i, ": ", optionsArray[i]);
                let paragraphElement = document.createElement('p');
                paragraphElement.textContent = 'üó≥' + (i+1) + ". " + optionsArray[i];
                optionsContainer.appendChild(paragraphElement);
            }
        }

        function convertUTCtoDate(utcTimestamp) {
            // Create a new Date object with the UTC timestamp
            // the UTC timestamp should be in miliseconds
            const date = new Date(parseInt(utcTimestamp, 10));

            // Get the individual components of the date and time
            const year = date.getUTCFullYear();
            const month = date.getUTCMonth() + 1; // Months are zero-indexed, so add 1
            const day = date.getUTCDate();
            const hours = date.getUTCHours();
            const minutes = date.getUTCMinutes();
            const seconds = date.getUTCSeconds();

            const formattedDateTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

            return formattedDateTime;
        }
    </script>
</head>

<body onload="getSurveyComponents();">
    <header>
        <h1><a href="/">PORPOISE</a> Survey:</h1>
    </header>

    <h2 id="üê¨"></h2>

    <div id="üó≥"></div>

    <p id="‚è∞"></p>
    <p id="üîÆ"></p>

    <footer>
        <p>
            &copy; 2024 PORPOISE Network. All rights reserved.
        </p>
    </footer>
</body>

</html>